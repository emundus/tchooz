/**
 * Action Element
 *
 * @copyright: Copyright (C) 2005-2016  Media A-Team, Inc. - All rights reserved.
 * @license: GNU/GPL http://www.gnu.org/copyleft/gpl.html
 */
define(["jquery","fab/element"],(function(t,e){return window.FbAction=new Class({Extends:e,initialize:function(t,e){this.setPlugin("fabrikAction"),this.parent(t,e),this.addClickEvent("click",e)},addClickEvent:function(e,n){t(this.element).on(e,(t=>{t&&t.stopPropagation();var e=document.querySelector("#action_loader_"+this.element.id);e&&(e.style.display="inline-block");var o={type:n.type,options:JSON.stringify(n.options)},i=new FormData;for(var a in o)i.append(a,o[a]);fetch("/index.php?option=com_emundus&controller=automation&task=runaction",{method:"POST",body:i}).then((t=>{if(e&&(e.style.display="none"),t.ok)return t.json()})).then((t=>{this.manageActionResult(t,n.type)}))}))},manageActionResult:function(t,e){"generate_letter"===e&&(console.log(t.data[0]),Swal.fire({position:"center",icon:"success",title:Joomla.Text._("PLG_ELEMENT_ACTION_GENERATE_LETTER_SUCCESS_TITLE"),text:Joomla.Text._("PLG_ELEMENT_ACTION_GENERATE_LETTER_SUCCESS_MSG"),showConfirmButton:!0,confirmButtonText:Joomla.Text._("PLG_ELEMENT_ACTION_GENERATE_LETTER_DOWNLOAD"),reverseButtons:!0,customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}}).then((e=>{e.isConfirmed&&window.open(t.data[0].url+t.data[0].filename,"_blank")})))}}),window.FbAction}));