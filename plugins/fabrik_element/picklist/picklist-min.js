/*! Fabrik */
define(["jquery","fab/element"],function(t,e){return window.FbPicklist=new Class({Extends:e,initialize:function(t,e){this.setPlugin("fabrikpicklist"),this.parent(t,e),!0===this.options.allowadd&&(this.watchAddToggle(),this.watchAdd()),this.makeSortable(),this.addMobileSupport()},addMobileSupport:function(){var t,i,n,o;this.options.editable&&(t=this.getContainer(),i=t.getElement(".fromList"),n=t.getElement(".toList"),i)&&n&&(o=this,[i,n].each(function(t){t.addEvent("touchstart",function(t){var e=t.target;"LI"!==e.tagName||e.hasClass("emptypicklist")||(t.preventDefault(),o.handleTouch(t,e,i,n))})}))},handleTouch:function(t,e,i,n){var o=this,l=(t.touches[0],e.getStyle("opacity")),s=(e.setStyle("opacity","0.3"),e.clone()),a=e.getBoundingClientRect(),d=(s.setStyles({position:"fixed",left:a.left+"px",top:a.top+"px",width:a.width+"px","z-index":"9999","pointer-events":"none",border:"2px solid #40a9ff","box-shadow":"0 2px 8px rgba(0,0,0,0.2)"}),document.body.adopt(s),null),r=function(t){t.preventDefault();var t=t.touches[0],e=(s.setStyles({left:t.clientX-a.width/2+"px",top:t.clientY-a.height/2+"px"}),o.isOverElement(t.clientX,t.clientY,i)),t=o.isOverElement(t.clientX,t.clientY,n),e=e?i:t?n:null;e!==d&&(d&&d.setStyle("background-color",""),e&&e.setStyle("background-color","#e3f2fd"),d=e)},c=function(t){t.preventDefault(),document.removeEvent("touchmove",r),document.removeEvent("touchend",c),s.destroy(),e.setStyle("opacity",l),i.setStyle("background-color",""),n.setStyle("background-color",""),d&&d!==e.getParent()&&(d.adopt(e),o.setData(),o.showNotices())};document.addEvent("touchmove",r),document.addEvent("touchend",c)},isOverElement:function(t,e,i){i=i.getBoundingClientRect();return t>=i.left&&t<=i.right&&e>=i.top&&e<=i.bottom},makeSortable:function(){var i,n,o,l,t;this.options.editable&&(t=this.getContainer(),i=t.getElement(".fromList"),n=t.getElement(".toList"),o=i.getStyle("background-color"),(l=this).sortable=new Sortables([i,n],{clone:!0,revert:!0,opacity:.7,hovercolor:this.options.bghovercolour,onComplete:function(t){this.setData(),this.showNotices(t),l.fadeOut(i,o),l.fadeOut(n,o)}.bind(this),onSort:function(t,e){this.showNotices(t,e)}.bind(this),onStart:function(t,e){this.drag.addEvent("onEnter",function(t,e){this.lists.contains(e)&&(l.fadeOut(e,this.options.hovercolor),this.lists.contains(this.drag.overed))&&this.drag.overed.addEvent("mouseleave",function(){l.fadeOut(i,o),l.fadeOut(n,o)}.bind(this))}.bind(this))}}),t=[i.getElement("li.emptypicklist"),n.getElement("li.emptypicklist")],this.sortable.removeItems(t),this.showNotices())},fadeOut:function(t,e){new Fx.Tween(t,{wait:!1,duration:600}).start("background-color",e)},showNotices:function(t,e){t=t&&t.getParent("ul");for(var i=this.getContainer(),n=[i.getElement(".fromList"),i.getElement(".toList")],o=0;o<n.length;o++){var l,s=(l=n[o])===t||"null"===typeOf(t)?1:2,a=l.getElement("li.emptypicklist");l.getElements("li").length>s?a.hide():a.show()}},setData:function(){var t=this.getContainer().getElement(".toList").getElements("li[class!=emptypicklist]").map(function(t,e){return t.id.replace(this.options.element+"_value_","")}.bind(this));this.element.value=JSON.stringify(t)},watchAdd:function(){this.element.id;var n=this.getContainer(),o=n.getElement(".toList"),t=n.getElement("input[type=button]");"null"!==typeOf(t)&&t.addEvent("click",function(t){var e,i;value=n.getElement("input[name=addPicklistValue]"),labelEl=n.getElement("input[name=addPicklistLabel]"),label=labelEl.get("value"),""===(e="null"!==typeOf(value)?value.value:label)||""===label?alert(Joomla.JText._("PLG_ELEMENT_PICKLIST_ENTER_VALUE_LABEL")):(i=new Element("li",{class:"picklist",id:this.element.id+"_value_"+e}).set("text",label),o.adopt(i),this.sortable.addItems(i),t.stop(),"element"===typeOf(value)&&(value.value=""),labelEl.value="",this.setData(),this.addNewOption(e,label),this.showNotices())}.bind(this))},unclonableProperties:function(){return["form","sortable"]},watchAddToggle:function(){var t,e,i=this.getContainer(),n=i.getElement("div.addoption"),o=i.getElement(".toggle-addoption");this.mySlider&&(t=n.clone(),e=i.getElement(".fabrikElement"),n.getParent().destroy(),e.adopt(t),(n=i.getElement("div.addoption")).setStyle("margin",0)),this.mySlider=new Fx.Slide(n,{duration:500}),this.mySlider.hide(),o.addEvent("click",function(t){t.stop(),this.mySlider.toggle()}.bind(this))},cloned:function(t){delete this.sortable,!0===this.options.allowadd&&(this.watchAddToggle(),this.watchAdd()),this.makeSortable(),this.addMobileSupport(),this.parent(t)}}),window.FbPicklist});
//# sourceMappingURL=picklist-min.js.map